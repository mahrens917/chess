# Implementation Plan: Comprehensive Traditional Finance Module Expansion

## Current Status
- All 11 traditional finance modules already exist but are **minimally implemented** (9-14 theorems each)
- Recent crypto modules set pattern: 15-20 theorems + 15-20 detection functions per module
- Goal: Expand all traditional modules to match crypto quality & completeness

## Implementation Strategy
Expand each module from ~10 theorems to 15-20 theorems + detection functions, following established pattern:
- Each theorem uses universal no-arbitrage proof: `by_contra → push_neg → exfalso → noArbitrage`
- Include Quote (bid/ask) spreads with Fees.totalFee deductions
- Detection functions as computational Bool checks with Float types
- Tolerance bounds reflecting market friction

## Modules to Expand (In Priority Order)

### Phase A: Fixed Income Core (4 modules, ~70 theorems)

**1. InterestRates (Current: 9 theorems → Target: 18 theorems + 18 detection)**
   - **Existing**: Fixed-floating swap parity, floating leg dynamics
   - **New theorems to add**:
     - Swap curve consistency (discount factor monotonicity)
     - Basis point value (DV01) across tenors
     - Forward rate parity (FRA/futures no-arbitrage)
     - Swap spread constraints (basis between swaps & bonds)
     - Coupon vs accrued interest parity
     - Day-count convention adjustments
     - Cross-currency interest rate parity
     - Inflation-linked swap real rate constraints
     - Cap/floor parity with swaptions
     - Callable bond option-adjusted spread bounds
   - **Detection functions**: checkSwapParity, checkForwardRateParity, checkSwapSpread, etc.

**2. BondConvexity (Current: 13 theorems → Target: 18 theorems + 18 detection)**
   - **Existing**: Bond duration, convexity, price-yield relationship
   - **New theorems to add**:
     - Modified duration vs effective duration
     - Convexity parity (positive convexity bounds)
     - Price-yield arbitrage (curve positioning)
     - Duration matching for immunization
     - Key rate duration constraints
     - Butterfly spread arbitrage bounds
     - Curve flattener/steepener no-arbitrage
     - Carry-roll-down bounds
     - OAS (Option-Adjusted Spread) consistency
     - Credit spread duration interaction
   - **Detection functions**: checkDurationMatch, checkConvexityArb, checkOASBounds, etc.

**3. SwapBasis (Current: 11 theorems → Target: 18 theorems + 18 detection)**
   - **Existing**: Swap-futures basis, carry dynamics
   - **New theorems to add**:
     - Swap spread evolution (term structure of basis)
     - CCP clearing cost impact on basis
     - Cross-basis (different swap types)
     - Basis convergence at maturity
     - Repo rate impact on basis (financing)
     - CCR (counterparty credit risk) pricing
     - Treasury futures basis vs spot
     - Corporate bond basis to swaps
     - Basis inversion triggers (negative basis economics)
     - Basis volatility bounds
   - **Detection functions**: checkBasisConvergence, checkSwapFuturesBasis, checkCrossBasis, etc.

**4. RepoMarkets (Current: 12 theorems → Target: 18 theorems + 18 detection)**
   - **Existing**: Repo rate parity, collateral mechanics
   - **New theorems to add**:
     - General collateral (GC) vs special repo rate parity
     - Repo-to-maturity cost curves
     - Collateral haircut dynamics & volatility
     - Term repo spread (overnight vs term)
     - Reverse repo funding arbitrage
     - Cheapest-to-deliver impact on repo rates
     - Fail charges and settlement constraints
     - Tri-party repo collateral velocity
     - Repo rate term structure
     - Haircut arbitrage across collateral classes
   - **Detection functions**: checkRepoRateParity, checkHaircutArb, checkCtdImpact, etc.

### Phase B: Volatility & Greeks (3 modules, ~52 theorems)

**5. VolatilityDerivatives (Current: 12 theorems → Target: 18 theorems + 18 detection)**
   - **Existing**: Variance swap parity, realized-implied vol relationship
   - **New theorems to add**:
     - Volatility surface smoothness constraints
     - Calendar spread arbitrage (near vs far variance)
     - Variance swap convexity adjustment
     - Realized variance path dependence
     - Vol smile arbitrage (put-call implied vol parity)
     - Vol index futures basis (VIX futures vs spot)
     - Volatility swap vs variance swap parity
     - Jump risk pricing in variance swaps
     - Skew drift constraints
     - Term structure of volatility bounds
   - **Detection functions**: checkVarianceSwapParity, checkVolSmileArb, checkVolTermStructure, etc.

**6. Options/Greeks (Expand existing Greeks module: 6-8 theorems → Target: 16 theorems + 16 detection)**
   - **Existing**: Delta, gamma, vega bounds
   - **New theorems to add**:
     - Delta hedging cost bounds (realized vs implied vol)
     - Gamma-theta tradeoff (convexity cost)
     - Vega parity across strikes (vol smile)
     - Rho arbitrage (interest rate sensitivity)
     - Charm decay constraints (delta decay over time)
     - Vanna interaction (delta-vega coupling)
     - Volga arbitrage (vol of vol)
     - Greeks across moneyness spectrum
     - Delta neutrality maintenance costs
     - Vega rehedging frequency optimization
   - **Detection functions**: checkDeltaHedge, checkGammaTheta, checkVegaParity, etc.

**7. Options/Barriers (Expand existing: 5-6 theorems → Target: 18 theorems + 18 detection)**
   - **Existing**: Knock-in/knock-out parity
   - **New theorems to add**:
     - Barrier level arbitrage (touching vs not touching)
     - Double barrier arbitrage (range notes)
     - Rebate arbitrage bounds
     - Barrier monitoring frequency impact
     - Touch probability vs payout mechanics
     - Continuous vs discrete monitoring parity
     - Barrier + American feature combination
     - Barrier width vs payoff tradeoff
     - Knock-out probability bounds
     - Reverse barrier arbitrage
   - **Detection functions**: checkBarrierParity, checkRebateArb, checkMonitoringImpact, etc.

### Phase C: Commodities & Cross-Asset (3 modules, ~54 theorems)

**8. CommodityOptions (Current: 12 theorems → Target: 18 theorems + 18 detection)**
   - **Existing**: Convenience yield, forward curve parity
   - **New theorems to add**:
     - Commodity storage cost & carry relationship
     - Backwardation vs contango seasonality
     - Crack/crush/spark spread option bounds
     - Basis risk in commodity hedges
     - Commodity futures roll arbitrage
     - Commodity option skew (backwardation effect)
     - Strategic storage economics
     - Convenience yield estimation
     - Commodity financing parity
     - Commodity option exercise timing
   - **Detection functions**: checkConvenienceYield, checkCarryArb, checkStorageCost, etc.

**9. PortfolioTheory (Current: 9 theorems → Target: 18 theorems + 18 detection)**
   - **Existing**: Markowitz efficient frontier, CAPM
   - **New theorems to add**:
     - Minimum variance portfolio constraints
     - Maximum Sharpe ratio portfolio bounds
     - Risk parity rebalancing arbitrage
     - Factor exposure orthogonality
     - Diversification ratio constraints
     - Correlation regime shift bounds
     - Concentration limit arbitrage
     - Liquidity adjustment to frontier
     - Time-varying correlation impacts
     - Portfolio drawdown constraints
   - **Detection functions**: checkEfficientFrontier, checkCapmArb, checkDiversification, etc.

**10. DerivativesCrossAsset (Current: 12 theorems → Target: 18 theorems + 18 detection)**
   - **Existing**: Equity-rates derivatives, correlation arbitrage
   - **New theorems to add**:
     - Equity-rates basis (dividend models)
     - Credit-equity basis (default correlation)
     - FX volatility vs spot correlation
     - Carry trade basis dynamics
     - Cross-asset convexity (rates impact on equity)
     - Correlation smile (vol of vol structure)
     - Multi-asset option parity (rainbow options)
     - Asset class basis limits
     - Cross-asset futures roll
     - Structural correlation constraints
   - **Detection functions**: checkEquityRatesBasis, checkCreditEquityBasis, checkCorrelationArb, etc.

### Phase D: Advanced & Meta (2 modules, ~38 theorems)

**11. CreditDerivatives (Current: 13 theorems → Target: 18 theorems + 18 detection)**
   - **Existing**: CDS spread parity, credit curve
   - **New theorems to add**:
     - CDS-bond basis arbitrage (ASW spread)
     - Credit spread term structure
     - Counterparty risk adjustment (CVA)
     - Default leg vs premium leg parity
     - CDS index constituent arbitrage
     - Recovery rate impact on spreads
     - Seniority structure pricing (senior vs subordinated)
     - CDS tranche pricing (CDO)
     - Basis swap credit impact
     - Stressed credit regime constraints
   - **Detection functions**: checkCdsParity, checkAsw, checkCreditCurve, etc.

**12. StochasticCalculus (Current: 11 theorems → Target: 16 theorems + 16 detection)**
   - **Existing**: Ito's lemma, drift constraints
   - **New theorems to add**:
     - Girsanov measure change bounds
     - Martingale property verification
     - Local martingale vs martingale distinction
     - Quadratic variation convergence
     - Volatility term structure consistency
     - Jump diffusion coupling
     - Correlation matrix positive definiteness
     - Numeraire choice implications
     - SDE solution existence/uniqueness
     - Discretization error bounds
   - **Detection functions**: checkMartingale, checkVolatilityTerm, checkCorrelationMatrix, etc.

**13. ArbitrageDetection (Current: 14 theorems → Target: 20 theorems + 20 detection)**
   - **Existing**: Put-call parity, various arbitrage rules
   - **New theorems to add**: (System for detecting violations across ALL modules)
     - Cross-module arbitrage detection
     - Transaction cost aggregation
     - Multi-leg position timing
     - Execution slippage bounds
     - Market impact costs
     - Correlation breakdown detection
     - Liquidity event triggers
     - Circuit breaker implications
     - Counterparty default risk
     - Regulatory constraint arbitrage
   - **Detection functions**: Comprehensive cross-module arbitrage scanner

---

## Implementation Order
1. **Week 1-2: Fixed Income Core** (InterestRates → BondConvexity → SwapBasis → RepoMarkets)
2. **Week 3: Volatility & Greeks** (VolatilityDerivatives → Greeks → Barriers)
3. **Week 4: Commodities & Cross** (CommodityOptions → PortfolioTheory → DerivativesCrossAsset)
4. **Week 5: Advanced** (CreditDerivatives → StochasticCalculus → ArbitrageDetection)

## Deliverables Per Module
- ✓ 15-20 theorems with full proofs
- ✓ 15-20 detection functions (Bool-returning)
- ✓ Build verification (lake build)
- ✓ Single comprehensive commit per module or per phase
- ✓ Production-ready: bid/ask quotes, explicit fees, closed-form inequalities

## Total Scope
- **Modules**: 13 (11 expanded + crypto modules already done)
- **Total Theorems**: ~200 (79 crypto + ~130 traditional)
- **Total Detection Functions**: ~200
- **Total Code**: ~8,000+ lines

---

## Success Criteria
1. All modules build without errors
2. All theorems follow universal no-arbitrage pattern
3. All detection functions are computationally feasible
4. Comprehensive coverage of domain-specific arbitrage mechanics
5. Production-ready market microstructure (quotes, fees, slippage)

